<ion-header [translucent]="true">
  <ion-toolbar>
    <div class="ion-display-flex align-center gap-0-75 fs-4">
      <i class="fa-light fa-chevron-left"></i>
      <div>Add patient</div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div>
    <div>
      <div class="fs-4 px-1 py-0-5">{{sectionTitle}}</div>
      @if(selectedSection !== 5){
      <ion-progress-bar [value]="progressValue"></ion-progress-bar>}
    </div>
    @if(selectedSection === 1) {
    <form class="ion-padding ion-display-flex flex-column gap-1-5" [formGroup]="patientDetailsForm">
      <div class="ion-display-flex flex-column gap-0-5">
        <label for="title">Title</label>
        <ion-select placeholder="Select a title" interface="action-sheet" id="title" name="title"
          formControlName="title" class="input-main-class px-1 ">

          @for(title of titles; track title.id) {
          <ion-select-option [value]="title">{{title.name}}</ion-select-option>
          }
        </ion-select>

      </div>
      <div class="ion-display-flex flex-column gap-0-5">
        <label for="firstName">First name *</label>
        <ion-input id="firstName" placeholder="Enter first name" name="firstName" type="text"
          formControlName="firstName" class="input-main-class px-1"></ion-input>
      </div>
      <div class="ion-display-flex flex-column gap-0-5">
        <label for="lastName">Last name *</label>
        <ion-input id="lastName" placeholder="Enter last name" name="lastName" type="text" formControlName="lastName"
          class="input-main-class px-1"></ion-input>
      </div>
      <div class="ion-display-flex flex-column gap-0-5">
        <label for="initials">Initials</label>
        <ion-input id="initials" placeholder="Enter initials" name="initials" type="text" formControlName="initials"
          class="input-main-class px-1"></ion-input>
      </div>
      <div class="ion-display-flex flex-column gap-0-5">
        <label for="date">Date of birth</label>
             <ion-button (click)="openDatePicker()">Pick a Date</ion-button>
        <ion-datetime id="date" presentation="date" [preferWheel]="true" class="transparent-datetime"
          formControlName="dob"></ion-datetime>
      </div>
      <div class="ion-display-flex flex-column gap-0-5">
        <label for="gender">Gender *</label>
        <ion-select placeholder="Select a gender" interface="action-sheet" id="gender" name="gender"
          formControlName="gender" class="input-main-class px-1 ">

          @for(gender of genders; track gender.id) {
          <ion-select-option [value]="gender">{{gender.name}}</ion-select-option>
          }
        </ion-select>

      </div>
      <div class="ion-display-flex flex-column gap-0-5">
        <label for="ethnicity">Ethnicity</label>
        <ion-select placeholder="Select an ethnicity" interface="action-sheet" id="ethnicity" name="ethnicity"
          formControlName="ethnicity" class="input-main-class px-1 ">
          @for(ethnicity of ethnicities; track ethnicity.id) {
          <ion-select-option [value]="ethnicity">{{ethnicity.name}}</ion-select-option>
          }
        </ion-select>

      </div>
      <div class="ion-display-flex flex-column gap-0-5">
        <label for="languages">Languages known</label>
        <ion-select placeholder="Select a language" interface="action-sheet" id="languages" name="languages"
          formControlName="languages" class="input-main-class px-1 ">
          @for(language of languages; track language.id) {
          <ion-select-option [value]="language">{{language.name}}</ion-select-option>
          }
        </ion-select>

      </div>
      <div class="ion-display-flex flex-wrap gap-1-5">
        <div class="ion-display-flex align-center gap-0-5">
          <ion-toggle aria-label="Dark toggle" formControlName="dontChase"></ion-toggle>
          <label for="languages">Don't chase</label>
        </div>
        <div class="ion-display-flex align-center gap-0-5">
          <ion-toggle aria-label="Dark toggle" formControlName="onStop"></ion-toggle>
          <label for="languages">On stop</label>
        </div>
        <div class="ion-display-flex align-center gap-0-5">
          <ion-toggle aria-label="Dark toggle" formControlName="safeguarding"></ion-toggle>
          <label for="languages">Safeguarding</label>
        </div>
        <div class="ion-display-flex align-center gap-0-5">
          <ion-toggle aria-label="Dark toggle" formControlName="paperInvoice"></ion-toggle>
          <label for="languages">Paper invoices only for online payments</label>
        </div>
      </div>
    </form>}
    @if(selectedSection === 2) {
    <form class="ion-padding ion-display-flex flex-column gap-1-5" [formGroup]="addressForm">
      <div class="ion-display-flex flex-column gap-0-5">
        <label for="languages">Type *</label>
        <ion-select placeholder="Select a language" interface="action-sheet" id="languages" name="languages"
          formControlName="type" class="input-main-class px-1 ">
          @for(language of languages; track language.id) {
          <ion-select-option [value]="language">{{language.name}}</ion-select-option>
          }
        </ion-select>

      </div>
      <div class="ion-display-flex flex-column gap-0-5">
        <label for="postcode">Postcode</label>
        <ion-input id="postcode" placeholder="Enter postcode" name="postcode" type="text" formControlName="postcode"
          class="input-main-class px-1"></ion-input>
      </div>
      <div class="ion-display-flex flex-column gap-0-5">
        <label for="prefix">Prefix</label>
        <ion-input id="prefix" placeholder="Enter prefix" name="prefix" type="text" formControlName="prefix"
          class="input-main-class px-1"></ion-input>
      </div>
      <div class="ion-display-flex flex-column gap-0-5">
        <label for="address1">Address 1 *</label>
        <ion-input id="address1" placeholder="Enter address 1" name="address1" type="text" formControlName="address1"
          class="input-main-class px-1"></ion-input>
      </div>
      <div class="ion-display-flex flex-column gap-0-5">
        <label for="address2">Address 2</label>
        <ion-input id="address2" placeholder="Enter address 2" name="address2" type="text" formControlName="address2"
          class="input-main-class px-1"></ion-input>
      </div>
      <div class="ion-display-flex flex-column gap-0-5">
        <label for="address3">Address 3</label>
        <ion-input id="address3" placeholder="Enter address 3" name="address3" type="text" formControlName="address3"
          class="input-main-class px-1"></ion-input>
      </div>
      <div class="ion-display-flex flex-column gap-0-5">
        <label for="address4">Address 4</label>
        <ion-input id="address4" placeholder="Enter address 4" name="address4" type="text" formControlName="address4"
          class="input-main-class px-1"></ion-input>
      </div>
      <div class="ion-display-flex flex-wrap gap-1-5">
        <div class="ion-display-flex align-center gap-0-5">
          <ion-toggle aria-label="Dark toggle" formControlName="primary"></ion-toggle>
          <label for="languages">Primary</label>
        </div>
        <div class="ion-display-flex align-center gap-0-5">
          <ion-toggle aria-label="Dark toggle" formControlName="billing"></ion-toggle>
          <label for="languages">Billing</label>
        </div>
      </div>
    </form>}
    @if(selectedSection === 3) {
    <form class="ion-padding ion-display-flex flex-column gap-1-5">
      <div class="ion-display-flex flex-column gap-0-5">
        <button class="ion-padding secondary-button ion-display-flex gap-0-5 justify-center" id="open-modal"><i
            class="fa-thin fa-plus"></i>Add telecom</button>

        <div class="hidden-border">
          @for(telecom of addedTelecoms.value; track $index;let index = $index) {
          <div class="ion-display-flex justify-between py-1 align-center list-container">
            <div class="ion-display-flex flex-column gap-0-5">
              <div class="ion-display-flex align-center gap-0-5 fs-2">
                {{telecom.telecom.name}}@if(telecom.isPrimary){<span
                  class="fs-1 primary-indicatior">Primary</span>}@if(telecom.isPreferred){<span
                  class="fs-1 preferred-indicatior">Preferred</span>}</div>
              <div class="fs-3">{{telecom.value}}</div>
            </div>
            <div class="ion-display-flex gap-1">
              <i class="fa-light fa-pen-to-square fs-5" (click)="editTelecom(telecom)"></i>
              <i class="fa-light fa-trash fs-5" (click)="deleteTelecom(index)"></i>
            </div>

          </div>
          }
        </div>

        <ion-modal trigger="open-modal" #telecomModal [initialBreakpoint]="0.75"
          (ionModalDidDismiss)="telecomFormReset()">
          <ng-template>
            <ion-header>
              <ion-toolbar>
                <div class="ion-display-flex align-center gap-0-75 fs-4">
                  <div class="flex-1">Add telecom</div>
                  <i class="fa-thin fa-xmark" (click)="telecomFormReset();telecomModal.dismiss()"></i>
                </div>

              </ion-toolbar>
            </ion-header>
            <ion-content class="ion-padding">
              <form class="ion-display-flex flex-column gap-1-5" [formGroup]="telecomForm">
                <div class="ion-display-flex flex-column gap-0-5">
                  <label for="telecom">Telecom</label>
                  <ion-select placeholder="Select a telecom" interface="action-sheet" id="telecom" name="telecom"
                    class="input-main-class px-1 " formControlName="telecom">
                    @for(telecom of telecoms; track telecom.id) {
                    <ion-select-option [value]="telecom">{{telecom.name}}</ion-select-option>
                    }
                  </ion-select>

                </div>
                <div class="ion-display-flex flex-column gap-0-5">
                  <label for="value">{{telecomForm.get('telecom')?.value.name}}</label>
                  <ion-input id="value" placeholder="Enter {{telecomForm.get('telecom')?.value.name | lowercase}}"
                    name="value" type="text" class="input-main-class px-1" formControlName="value"></ion-input>
                </div>
                <div class="ion-display-flex flex-wrap gap-1-5">
                  <div class="ion-display-flex align-center gap-0-5">
                    <ion-toggle aria-label="Dark toggle" formControlName="isPrimary"></ion-toggle>
                    <label for="languages">is Primary ?</label>
                  </div>
                  <div class="ion-display-flex align-center gap-0-5">
                    <ion-toggle aria-label="Dark toggle" formControlName="isPreferred"></ion-toggle>
                    <label for="languages">is Preferred ?</label>
                  </div>
                </div>
                <div class="px-1 ion-display-flex justify-end align-center">
                  <button class="ion-padding primary-button" (click)="addTelecom()"
                    [disabled]="telecomForm.invalid">Add</button>
                </div>
              </form>

            </ion-content>
          </ng-template>
        </ion-modal>
      </div>



    </form>}
    @if(selectedSection === 4) {
    <form class="ion-padding ion-display-flex flex-column gap-1-5">
      <div class="ion-display-flex flex-column gap-0-5">
        <button class="ion-padding secondary-button ion-display-flex gap-0-5 justify-center" id="open-modal"><i
            class="fa-thin fa-plus"></i>Add identifiers</button>
        <div class="hidden-border">
          @for(identifier of addedIdentifiers.value; track $index;let index = $index) {
          <div class="ion-display-flex justify-between py-1 align-center list-container">
            <div class="ion-display-flex flex-column gap-0-5">
              <div class="ion-display-flex align-center gap-0-5 fs-2">
                {{identifier.identifier.name}}</div>
              <div class="fs-3">{{identifier.value}}</div>
            </div>
            <div class="ion-display-flex gap-1">
              <i class="fa-light fa-pen-to-square fs-5" (click)="editIdentifier(identifier)"></i>
              <i class="fa-light fa-trash fs-5" (click)="deleteIdentifier(index)"></i>
            </div>

          </div>
          }
        </div>
        <ion-modal trigger="open-modal" #identifierModal [initialBreakpoint]="0.5"
          (ionModalDidDismiss)="identifierFormReset()">
          <ng-template>
            <ion-header>
              <ion-toolbar>
                <div class="ion-display-flex align-center gap-0-75 fs-4">
                  <div class="flex-1">Add identifier</div>
                  <i class="fa-thin fa-xmark" (click)="identifierFormReset();identifierModal.dismiss()"></i>
                </div>
              </ion-toolbar>
            </ion-header>
            <ion-content class="ion-padding">
              <form class="ion-display-flex flex-column gap-1-5" [formGroup]="identifierForm">
                <div class="ion-display-flex flex-column gap-0-5">
                  <label for="identifier">Identifier</label>
                  <ion-select placeholder="Select a identifier" interface="action-sheet" id="identifier"
                    formControlName="identifier" class="input-main-class px-1 ">
                    @for(identifier of identifiers; track identifier.id) {
                    <ion-select-option [value]="identifier">{{identifier.name}}</ion-select-option>
                    }
                  </ion-select>
                </div>
                <div class="ion-display-flex flex-column gap-0-5">
                  <label for="value">Value</label>
                  <ion-input id="value" placeholder="Enter value" formControlName="value" type="text"
                    class="input-main-class px-1"></ion-input>
                </div>
                <div class="px-1 ion-display-flex justify-end align-center">
                  <button class="ion-padding primary-button" (click)="addIdentifier()"
                    [disabled]="identifierForm.invalid">Add</button>
                </div>
              </form>

            </ion-content>
          </ng-template>
        </ion-modal>

      </div>

    </form>}
    @if(selectedSection === 5) {

    <div class="ion-padding ion-display-flex flex-column gap-1-5">
      <div class="ion-padding ion-display-flex flex-column gap-1-5 background-container">
        <div class="fs-3 title">Patient details</div>
        <div class="ion-display-flex flex-column gap-1-5">
          <div class="ion-display-flex justify-between">
            <div class="fs-2">Title</div>
            <div>{{patientDetailsForm.get('title')?.value.name || 'N/A'}}</div>
          </div>
          <div class="ion-display-flex justify-between">
            <div class="fs-2">First name</div>
            <div>{{patientDetailsForm.get('firstName')?.value || 'N/A'}}</div>
          </div>
          <div class="ion-display-flex justify-between">
            <div class="fs-2">Last name</div>
            <div>{{patientDetailsForm.get('lastName')?.value || 'N/A'}}</div>
          </div>
          <div class="ion-display-flex justify-between">
            <div class="fs-2">Initials</div>
            <div>{{patientDetailsForm.get('initials')?.value || 'N/A'}}</div>
          </div>
          <div class="ion-display-flex justify-between">
            <div class="fs-2">Date of birth</div>
            <div>{{(patientDetailsForm.get('dob')?.value | date:'longDate') || 'N/A'}}</div>
          </div>
          <div class="ion-display-flex justify-between">
            <div class="fs-2">Gender</div>
            <div>{{patientDetailsForm.get('gender')?.value.name || 'N/A'}}</div>
          </div>
          <div class="ion-display-flex justify-between">
            <div class="fs-2">Ethnicity</div>
            <div>{{patientDetailsForm.get('ethnicity')?.value.name || 'N/A'}}</div>
          </div>
          <div class="ion-display-flex justify-between">
            <div class="fs-2">Languages known</div>
            <div>{{patientDetailsForm.get('languages')?.value.name || 'N/A'}}</div>
          </div>
          <div class="ion-display-flex justify-between">
            <div class="fs-2">Don't chase</div>
            <div>{{patientDetailsForm.get('dontChase')?.value ? 'Yes' : 'No'}}</div>
          </div>
          <div class="ion-display-flex justify-between">
            <div class="fs-2">On stop</div>
            <div>{{patientDetailsForm.get('onStop')?.value ? 'Yes' : 'No'}}</div>
          </div>
          <div class="ion-display-flex justify-between">
            <div class="fs-2">Safeguarding</div>
            <div>{{patientDetailsForm.get('safeguarding')?.value ? 'Yes' : 'No'}}</div>
          </div>
          <div class="ion-display-flex justify-between">
            <div class="fs-2">Paper invoices only for online payments</div>
            <div>{{patientDetailsForm.get('paperInvoice')?.value ? 'Yes' : 'No'}}</div>
          </div>

        </div>
      </div>
      <div class="ion-padding ion-display-flex flex-column gap-1-5 background-container">
        <div class="fs-3 title">Address</div>
        <div class="ion-display-flex flex-column gap-1-5">
          <div class="ion-display-flex justify-between">
            <div class="fs-2">Type</div>
            <div>{{addressForm.get('type')?.value.name || 'N/A'}}</div>
          </div>
          <div class="ion-display-flex justify-between">
            <div class="fs-2">Postcode</div>
            <div>{{addressForm.get('postcode')?.value || 'N/A'}}</div>
          </div>
          <div class="ion-display-flex justify-between">
            <div class="fs-2">Prefix</div>
            <div>{{addressForm.get('prefix')?.value || 'N/A'}}</div>
          </div>
          <div class="ion-display-flex justify-between">
            <div class="fs-2">Address 1</div>
            <div>{{addressForm.get('address1')?.value || 'N/A'}}</div>
          </div>
          <div class="ion-display-flex justify-between">
            <div class="fs-2">Address 2</div>
            <div>{{addressForm.get('address2')?.value || 'N/A'}}</div>
          </div>
          <div class="ion-display-flex justify-between">
            <div class="fs-2">Address 3</div>
            <div>{{addressForm.get('address3')?.value || 'N/A'}}</div>
          </div>
          <div class="ion-display-flex justify-between">
            <div class="fs-2">Address 4</div>
            <div>{{addressForm.get('address4')?.value || 'N/A'}}</div>
          </div>
          <div class="ion-display-flex justify-between">
            <div class="fs-2">Primary</div>
            <div>{{addressForm.get('primary')?.value ? 'Yes' : 'No'}}</div>
          </div>
          <div class="ion-display-flex justify-between">
            <div class="fs-2">Billing</div>
            <div>{{addressForm.get('billing')?.value ? 'Yes' : 'No'}}</div>
          </div>
        </div>
      </div>
      <div class="ion-padding ion-display-flex flex-column  background-container">
        <div class="fs-3 title">Telecoms</div>
        <div class="ion-display-flex flex-column hidden-border">
          @for(telecom of addedTelecoms.value; track $index;let index = $index) {
          <div class="ion-display-flex justify-between py-1 align-center list-container">
            <div class="ion-display-flex flex-column gap-0-5">
              <div class="ion-display-flex align-center gap-0-5 fs-2">
                {{telecom.telecom.name}}@if(telecom.isPrimary){<span
                  class="fs-1 primary-indicatior">Primary</span>}@if(telecom.isPreferred){<span
                  class="fs-1 preferred-indicatior">Preferred</span>}</div>
              <div class="fs-3">{{telecom.value}}</div>
            </div>

          </div>
          }
        </div>

      </div>
      <div class="ion-padding ion-display-flex flex-column  background-container">
        <div class="fs-3 title">Identifiers</div>
        <div class="ion-display-flex flex-column hidden-border">
          @for(identifier of addedIdentifiers.value; track $index;let index = $index) {
          <div class="ion-display-flex justify-between py-1 align-center list-container">
            <div class="ion-display-flex flex-column gap-0-5">
              <div class="ion-display-flex align-center gap-0-5 fs-2">
                {{identifier.identifier.name}}</div>
              <div class="fs-3">{{identifier.value}}</div>
            </div>

          </div>
          }
        </div>  
        </div>
    </div>
    }

    <div class="ion-display-flex justify-between align-center ion-padding">
      <button class="ion-padding secondary-button" (click)="cancel()">{{selectedSection === 1 ? 'Cancel' :
        'Back'}}</button>

      <button class="ion-padding primary-button" (click)="nextStep()"
        [disabled]="(patientDetailsForm.invalid && selectedSection === 1) || (selectedSection === 2 && addressForm.invalid) || (selectedSection === 3 && !addedTelecoms.length) || (selectedSection === 4 && !addedIdentifiers.length)">
        {{selectedSection === 5 ? 'Save' :
        'Next'}}</button>
    </div>
  </div>




</ion-content>